# ============================================================================
# VGPT2 Training Environment - Pinned Dependencies
# Last Updated: 2025-12-29 (after successful training completion)
# ============================================================================
#
# IMPORTANT: Python 3.11 or 3.12 required (NOT 3.13 or 3.14!)
# Python 3.14 breaks dill/pickle serialization used by datasets library
# Error: TypeError: Pickler._batch_setitems() takes 2 positional arguments
#
# ============================================================================
# INSTALL ORDER MATTERS! Run these commands in sequence:
# ============================================================================
#
# Step 1: Install PyTorch with CUDA 12.4
#   pip install torch==2.6.0+cu124 torchvision==0.21.0+cu124 torchaudio==2.6.0+cu124 --index-url https://download.pytorch.org/whl/cu124
#
# Step 2: Install core dependencies
#   pip install "numpy<2.0.0" cffi python-dateutil pandas
#
# Step 3: Install ML libraries (PINNED VERSIONS - DO NOT UPGRADE)
#   pip install transformers==4.57.1 peft==0.17.1 accelerate==1.11.0
#
# Step 4: Install LlamaFactory from source
#   pip install -e ".[torch,metrics]"
#
# Step 5: Install quantization support (optional)
#   pip install bitsandbytes
#
# ============================================================================
# CRITICAL VERSION PINS (LlamaFactory 0.9.4.dev0 compatibility)
# ============================================================================
# transformers==4.57.1   # NOT 4.57.3 - breaks llamafactory
# peft==0.17.1           # NOT 0.18.0 - breaks llamafactory
# accelerate==1.11.0     # NOT 1.12.0 - breaks llamafactory
# ============================================================================

# core deps
transformers>=4.49.0,<=4.56.2,!=4.52.0; python_version < '3.10'
transformers>=4.49.0,<=4.57.3,!=4.52.0,!=4.57.0; python_version >= '3.10'
datasets>=2.16.0,<=4.0.0
accelerate>=1.3.0,<=1.11.0
peft>=0.14.0,<=0.17.1
trl>=0.8.6,<=0.9.6
# gui
gradio>=4.38.0,<=5.45.0
matplotlib>=3.7.0
tyro<0.9.0
# ops
einops
numpy<2.0.0  # CRITICAL: trl requires numpy<2.0.0, pip may install 2.4.0 which breaks
pandas>=2.0.0
python-dateutil>=2.8.2  # Required by pandas, sometimes not auto-installed
cffi>=1.0  # Required by soundfile
scipy
# model and tokenizer
sentencepiece
tiktoken
modelscope>=1.14.0
hf-transfer
safetensors<=0.5.3
# python
fire
omegaconf
packaging
protobuf
pyyaml
pydantic<=2.10.6
# api
uvicorn
fastapi
sse-starlette
# media
av
librosa
# yanked
propcache!=0.4.0
